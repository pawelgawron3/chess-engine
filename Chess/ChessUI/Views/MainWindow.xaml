<Window x:Class="ChessUI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ChessUI.ViewModels"
        xmlns:local="clr-namespace:ChessUI.Views"
        mc:Ignorable="d"
        Title="Chess Engine" Width="800" SizeToContent="Height"
        Icon="/Assets/Images/icon.ico"
        WindowStartupLocation="CenterScreen"
        Background="#9e9e9e">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Viewbox Stretch="Uniform">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="600" />
                <ColumnDefinition Width="200" />
            </Grid.ColumnDefinitions>

            <Grid x:Name="BoardGrid"
                  Width="600"
                  Height="600"
                  Grid.Column="0"
                  MouseDown="BoardGrid_MouseDown">
                <Grid.Background>
                    <ImageBrush ImageSource="/Assets/Images/Board.png" />
                </Grid.Background>

                <Canvas IsHitTestVisible="False">
                    <ItemsControl ItemsSource="{Binding Highlights}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:HighlightViewModel}">
                                <Ellipse Width="{Binding Size}"
                                         Height="{Binding Size}"
                                         Stroke="{Binding StrokeBrush}"
                                         StrokeThickness="{Binding StrokeThickness}"
                                         Fill="{Binding FillBrush}"
                                         IsHitTestVisible="False" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="Canvas.Left" Value="{Binding Left}" />
                                <Setter Property="Canvas.Top" Value="{Binding Top}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </Canvas>

                <Canvas RenderOptions.BitmapScalingMode="HighQuality">
                    <ItemsControl ItemsSource="{Binding Pieces}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:PieceViewModel}">
                                <Image Width="{Binding Size}" Height="{Binding Size}"
                                       Source="{Binding Image}"
                                       IsHitTestVisible="False" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>

                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="Canvas.Left" Value="{Binding Left}" />
                                <Setter Property="Canvas.Top" Value="{Binding Top}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </Canvas>

                <local:PromotionMenu DataContext="{Binding PromotionVM}"
                                     Visibility="{Binding DataContext.IsPromotionVisible,
                                                  RelativeSource={RelativeSource AncestorType=Window},
                                                  Converter={StaticResource BooleanToVisibilityConverter}}"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />
            </Grid>

            <Border Background="WhiteSmoke"
                    Padding="10"
                    BorderBrush="#ccc"
                    BorderThickness="1,0,1,0"
                    Grid.Column="1">

                <StackPanel VerticalAlignment="Top">

                    <TextBlock Text="Game Info"
                               TextAlignment="Center"
                               FontWeight="Bold"
                               FontSize="18"
                               Margin="0,0,0,10"
                               Foreground="#333" />

                    <TextBlock Text="{Binding GameStatusText}"
                               FontSize="14"
                               FontWeight="Bold"
                               Foreground="#333"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10" />

                    <StackPanel>
                        <TextBlock Text="Last Move:" FontWeight="SemiBold" />
                        <TextBlock Text="{Binding LastMoveText}" Margin="0,2,0,0" />
                    </StackPanel>

                    <StackPanel>
                        <TextBlock Text="Move Count:" FontWeight="SemiBold" />
                        <TextBlock Text="{Binding MoveCountText}" Margin="0,2,0,0" />
                    </StackPanel>

                    <Button Content="Generate Next Move"
                            Width="140"
                            Height="35"
                            Margin="0,10,0,0"
                            Background="#FF333333"
                            Foreground="White"
                            BorderThickness="0"
                            FontWeight="Bold"
                            Cursor="Hand"
                            Command="{Binding AiMoveCommand}">
                    </Button>

                    <Button Content="Undo (Left Arrow)"
                            Width="140"
                            Height="30"
                            Margin="0,6,0,0"
                            Command="{Binding UndoCommand}" />
                </StackPanel>
            </Border>
        </Grid>
    </Viewbox>
</Window>